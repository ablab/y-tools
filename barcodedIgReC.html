<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <title>BarcodedIgReC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
</head>
<body>
<section class="page-header">
    <h1 class="project-name" align=center>BarcodedIgReC</h1>
    <h2 class="project-tagline" align=center>A modification of the <a href="index.html#ig_repertoire_constructor" style="color:white;font-weight:bold;text-decoration: underline">IgReC</a> algorithm for barcoded Illumina MiSeq reads</h2>
    <a href="https://github.com/yana-safonova/ig_repertoire_constructor" class="btn"><b>View on GitHub</b></a>
    <a href="https://github.com/yana-safonova/ig_repertoire_constructor/zipball/master" class="btn"><b>Download .zip</b></a>
    <a href="https://github.com/yana-safonova/ig_repertoire_constructor/tarball/master" class="btn"><b>Download .tar.gz</b></a>
</section>

<section class="main-content">

    <h2>Content</h2>
    <p align = "center">
    <ul>
        <li><a href = "#motivation">Motivation</a></li>
        <li><a href = "#algorithm">Algorithm</a></li>
        <li><a href = "#results">Results</a></li>
        <li><a href = "#references">Manual and citations</a></li>
    </ul>
    </p>


    <h2 id = "motivation">Motivation</h2>
    <p align = "justify">
        Repertoire construction is a complex clustering problem with the largest obstacle of distinguishing natural diversity of antibodies from PCR errors.
        Using molecular barcoding (UMIs) helps to separate these two sources of variations in Rep-seq and simplifies error correction.
    </p>


    <h3 id = "umis">Molecular barcodes</h3>
    <p align = "justify">
        Molecular barcodes are short genetic sequences attached to each RNA molecule
        so that all amplified copies of this molecule contain the same barcode.
        Hence errors in reads can be corrected by constructing the consensus of all reads with the same barcode.
        However, there are three barcoded Rep-seq features which may damage the quality of the repertoire when not taken care of.
    </p>

    <p align = justify>
        <b>Barcode errors.</b>
        Some reads in barcoded Rep-seq datasets have amplification errors within barcodes.
        Ignoring barcoding errors leads to an explosion of small clusters that should be merged with larger ones.
    </p>

    <p align = justify>
        <b>Chimeric reads.</b>
        Some Rep-seq sample preparation protocols produce many chimeric reads (up to 8%).
        Failure to detect chimeric reads reduces the accuracy of the consensus sequences in the constructed repertoire
        and may lead to artificially inflated diversity.
    </p>

    <p align = justify>
        <b>Barcode collisions.</b>
        Unrelated reads can have equal barcodes for two reasons.
        Either two molecules initially got identical barcodes attached,
        or barcodes got corrupted during amplification becoming equal afterwards.
        Ignoring barcode collisions may lead to a loss of natural diversity and corruption of the consensus sequences.
    </p>
    <table align = "center" width = "100%">
        <tr>
            <td align = center><img src="docs/barigrec_figures/barcoding_problems.jpg" width = "90%" alt="pipeline"></td>
        </tr>
        <tr>
            <td align = justify><small>
                Each column represents reads with the same barcode shown on the top of the column.
                Each color represents reads originating from the same RNA molecule.
                E.g., blue and green reads in the left column share the same barcode GGTCA (barcode collision).
                Some of red reads accumulated barcode error during amplification (shown as ACTTG barcode error).
                The yellow-blue and yellow-red reads are chimeric.
            </small></td>
        </tr>
    </table>


    <h3 id = "quantification">Molecule quantification</h3>
    In addition to easier error correction barcoding allows to quantify RNA molecules more precisely.
    Roughly speaking the number of molecules representing a single clone is the number of barcodes in the corresponding cluster.
    BarcodedIgReC takes advantage of its barcode correction step to avoid overestimation of the molecule number.
    One can estimate the number of RNA molecules through the number of reads in the cluster.
    However, as the following figure shows, such estimation can be very inaccurate.
    <table align = center>
        <tr>
            <td align = center>
                <img src = "docs/barigrec_figures/umi_cnt_to_read_cnt.png" width = 90% alt = "Barcode count to read count scatterplot">
            </td>
        </tr>
    </table>


    <h2 id = "algorithm">Algorithm</h2>
    <p align = justify>
        BarcodedIgReC takes as an input demultiplexed paired-end or single reads with unique molecular identifiers (UMIs).
        Reads should cover variable region of antibodies/TCRs.
        BarcodedIgReC corrects sequencing and amplification errors and constructs an antibody repertoire.
    </p>
    The algorithm performs the following steps:
    <ul>
        <li><b><a href = "index.html#vj_finder">VJ Finder</a>: </b>V, J labeling, cleaning, aligning and cropping input reads.</li>
        <li><b>Clustering using barcode information:</b> read clustering using barcode information and barcode error correction.
        On this step the algorithm forms clusters of related reads, but some of them still need to be united.</li>
        <li><b><a href = "index.html">IgReC</a>:</b> use consensuses of clusters constructed on the previous step as an input set for a non-barcoded IgReC tool.
        On this step we use custom clustering parameters for IgReC to merge only almost identical sequences.</li>
    </ul>

    <h3 id = "clustering">Clustering using barcode information</h3>
    <p align = justify>
        On this step BarcodedIgReC focuses on dealing with already mentioned artifacts which are specific for barcoded data.
        The algorithm groups reads by barcodes.
        The groups are clustered by distance between reads to resolve barcode collisions.
        This handles both types of barcode collisions, that is when two molecules get the same barcode, and when two unrelated reads get the same barcode
        (as a result of almost collided molecule barcodes and a barcode error).
        After that the clusters which have both close barcodes and consensuses are united.
    </p>


    <h2 id = "results">Results</h2>
    <p align = justify>
        We observe about 2 amplification errors per read on average for real datasets.
        We simulated a barcoded dataset with such parameters
        and obtained the following results reflecting the quality of repertoires constructed by BarcodedIgReC.
    </p>

    <h3 id = "artifacts_results">Handling artifacts of barcoded datasets</h3>
    <p align = justify>
        <ul>
            <li>
                BarcodedIgReC identifies and corrects 68% of reads with erroneous barcodes.
                The remaining reads with erroneous barcodes form singleton clusters.
            </li>
            <li>
                BarcodedIgReC detects 30% of chimeras introduced by the simulation.
                The rest of chimeras do not contribute or harm the final repertoire after the result filtering.
            </li>
            <li>BarcodedIgReC corrects 96% of barcode collisions.</li>
        </ul>
    </p>

    <h3 id = "sens_prec">Sensitivity and precision of constructed repertoires</h3>
    <p align = justify>
    </p>
    <div align = center>
        <img src = "docs/barigrec_figures/simulated_barcoded_read_error_rate_2.png" width = 70% alt = "Sensitivity-precision plot on read level">
    </div>

    <h3 id = "multiplicity">Reconstructed cluster sizes</h3>
    <p align = justify>
        We analyze how precisely BarcodedIgReC reconstructs cluster size.
        Figure on the left shows dependence of a number of reads in reconstructed cluster on a number of reads in a reference cluster.
        The median ratio of corresponding cluster read sizes is 0.81.
        Figure on the right shows the same dependence, but for molecule number instead of read number.
        It reflects how well we can estimate molecule number after repertoire construction.
        The median ratio of corresponding cluster molecule sizes is 0.9.
    </p>
    <table align = center>
        <tr>
            <td>
                <img src = "docs/barigrec_figures/reference_vs_constructed_size_reads.png" width = 90% alt = "Reference vs constructed size in terms of read number">
            </td>
            <td>
                <img src = "docs/barigrec_figures/reference_vs_constructed_size_umi.png" width = 90% alt = "Reference vs constructed size in terms of barcode number">
            </td>
        </tr>
    </table>



    <h2 id = "references">Manual and citations</h2>
    <p align = "justify">
        BarcodedIgReC manual can be found <a href = 'barcodedIgReC_manual.html'>here</a>.
    </p>

    <p align = "justify">
        <b>Citation:</b>
        Alexander Shlemov, Sergey Bankevich, Andrey Bzikadze,
        Dmitriy Chudakov,
        Yana Safonova,
        and Pavel A. Pevzner.
        Reconstructing antibody repertoires from error-prone immunosequencing datasets <i>(submitted)</i>
    </p>

    <footer class="site-footer">
        <span class="site-footer-owner">
            <a href="https://github.com/yana-safonova/ig_repertoire_constructor">IgRepertoireConstructor</a> is maintained by
            Center for Algorithmic Biotechnology, Saint Petersburg State University.
        </span>
    </footer>

</section>


</body>
</html>

